import UIkit from 'uikit'
import { App, Form } from '../../modules/scripts/_core'

document.addEventListener(`DOMContentLoaded`, function () {
  const app = new App()
  app.init()

  // HEADER

  if (window.innerWidth < app.lg) {
    UIkit.sticky(`.header`, {
      top: '100vh',
      animation: 'uk-animation-slide-top'
    })
    UIkit.slider(`.advantages__slider`)
    UIkit.slider(`.reviews__slider`)
    
    if (app.isMobile.iOS()) {
        document.querySelectorAll(`[data-mob-any]`).forEach(el => el.classList.add('d-none'))
    } else {
        document.querySelectorAll(`[data-mob-ios]`).forEach(el => el.classList.add('d-none'))
    }
    
  }
  const zips = {
    "40210": "30",
    "40211": "30",
    "40212": "30",
    "40213": "30",
    "40215": "90",
    "40217": "90",
    "40219": "90",
    "40221": "90",
    "40223": "90",
    "40225": "90",
    "40227": "90",
    "40229": "90",
    "40231": "90",
    "40233": "30",
    "40235": "90",
    "40237": "30",
    "40239": "30",
    "40468": "90",
    "40470": "30",
    "40472": "90",
    "40474": "30",
    "40476": "30",
    "40477": "30",
    "40479": "30",
    "40489": "90",
    "40545": "90",
    "40547": "90",
    "40549": "90",
    "40589": "90",
    "40591": "90",
    "40593": "90",
    "40595": "90",
    "40597": "90",
    "40599": "90",
    "40625": "90",
    "40627": "90",
    "40629": "90",
    "40721": "150",
    "40723": "150",
    "40724": "150",
    "45329": "180",
    "45356": "180",
    "45357": "180",
    "45359": "180",
    "45355": "180",
    "45143": "180",
    "45326": "180",
    "45327": "180",
    "45141": "180",
    "45309": "180",
    "45144": "180",
    "45127": "180",
    "45145": "180",
    "45139": "180",
    "45128": "180",
    "45147": "180",
    "45130": "180",
    "45138": "180",
    "45276": "180",
    "45136": "180",
    "45307": "180",
    "45279": "180",
    "45277": "180",
    "45134": "180",
    "45131": "180",
    "45149": "180",
    "45133": "180",
    "45219": "180",
    "45239": "180",
    "45259": "180",
    "45289": "180",
    "45257": "180",
    "40878": "90",
    "40880": "90",
    "46045": "180",
    "46047": "180",
    "46049": "180",
    "46117": "180",
    "46119": "180",
    "46145": "180",
    "46149": "180",
    "46236": "180",
    "46238": "180",
    "46240": "180",
    "46242": "180",
    "45879": "180",
    "45881": "180",
    "45883": "180",
    "45884": "180",
    "45886": "180",
    "45888": "180",
    "45889": "180",
    "45891": "180",
    "45894": "180",
    "45897": "180",
    "45899": "180",
    "45964": "180",
    "45968": "180",
    "10243": "120",
    "10245": "120",
    "10997": "120",
    "10179": "120",
    "10249": "120",
    "10247": "120",
    "10317": "120",
    "12435": "120",
    "10999": "120",
    "10969": "120",
    "10178": "120",
    "10407": "120",
    "10369": "120",
    "10367": "120",
    "10315": "120",
    "10319": "120",
    "13055": "120",
    "13053": "120",
    "13088": "120",
    "13086": "120",
    "10409": "120",
    "10405": "120",
    "10439": "120",
    "10437": "120",
    "10435": "120",
    "10119": "120",
    "10117": "120",
    "10115": "120",
    "10785": "120",
    "10963": "120",
    "10967": "120",
    "12047": "120",
    "12045": "120",
    "12059": "120",
    "12437": "120",
    "12057": "120",
    "12055": "120",
    "12051": "120",
    "12347": "120",
    "12109": "120",
    "12105": "120",
    "12103": "120",
    "12157": "120",
    "10829": "120",
    "10781": "120",
    "10783": "120",
    "10787": "120",
    "10559": "120",
    "13355": "120",
    "13189": "120",
    "13059": "120",
    "13057": "120",
    "12689": "120",
    "12687": "120",
    "12679": "120",
    "12685": "120",
    "12683": "120",
    "10318": "120",
    "13129": "180",
    "13127": "180",
    "13125": "180",
    "13089": "180",
    "13051": "180",
    "13409": "180",
    "13407": "180",
    "13349": "180",
    "13351": "180",
    "13403": "180",
    "13405": "180",
    "13469": "180",
    "13435": "180",
    "13437": "180",
    "13509": "180",
    "13507": "180",
    "13505": "180",
    "13503": "180",
    "14053": "180",
    "14193": "180",
    "12205": "180",
    "14199": "180",
    "14197": "180",
    "10715": "180",
    "10717": "180",
    "10779": "180",
    "10777": "180",
    "10719": "180",
    "10707": "180",
    "10713": "180",
    "10709": "180",
    "10629": "120",
    "10627": "120",
    "14057": "180",
    "10711": "180",
    "10625": "120",
    "10623": "120",
    "10789": "180",
    "10823": "180",
    "10827": "180",
    "10825": "180",
    "14129": "180",
    "14163": "180",
    "14165": "180",
    "14167": "180",
    "14169": "180",
    "14195": "180",
    "12207": "180",
    "12209": "180",
    "12279": "180",
    "12277": "180",
    "12305": "180",
    "12307": "180",
    "12309": "180",
    "12247": "180",
    "12167": "180",
    "12203": "180",
    "12169": "180",
    "12165": "180",
    "12163": "180",
    "12161": "180",
    "12159": "180",
    "12101": "180",
    "10965": "180",
    "12049": "180",
    "12053": "180",
    "12359": "180",
    "12351": "180",
    "12349": "180",
    "12107": "180",
    "12099": "180",
    "10961": "120",
    "13187": "120",
    "12189": "120",
    "10551": "120",
    "10553": "120",
    "10555": "120",
    "10557": "120",
    "13347": "120",
    "13353": "120",
    "13357": "120",
    "13359": "120",
    "13627": "120",
    "10585": "120",
    "10587": "120",
    "12043": "120",
    "14880": "999"
  }
  // MAP
  const formStepStart = new Form({
    form: '.lage-step--start',
    onSuccess: (form) => {
      if (zips[form.querySelector(`input`).value]) {
        app.changeActivitySet([...form.parentElement.children], 1)
        form.parentElement.querySelector('.lage-step-ok-time').innerText = zips[form.querySelector(`input`).value]
      } else {
        app.changeActivitySet([...form.parentElement.children], 2)
        let input = document.createElement('input')
        input.type = 'hidden'
        input.value = form.querySelector(`input`).value
        input.name = "zip"
        form.parentElement.querySelector('.lage-step--email').append(input)
      }
    }
  })


  const formStepEmail = new Form({
    form: '.lage-step--email',
    onSuccess: (form) => {
      app.changeActivitySet([...form.parentElement.children], 3)
      const formData = new FormData(form)

      fetch(`${app._apiBase}mail.php`, {
          method: 'post',
          body: formData,
          mode: 'no-cors'
      }).then(response => {
          // console.log(response)
          return response.text()
      }).then(text => {
          // console.log(text)
      }).catch(error => {
          console.error(error)
      })
    }
  })

  document.querySelector(`.lage-step-link`).addEventListener('click', (event) => {
    event.preventDefault()
    app.changeActivitySet([...document.querySelector(`.lage__map-item`).children], 0)
  })


  // app.letListClickActive(document.querySelector(`ul.list`))
  // app.videoSpy(`#video .popup__body`, 'fmT2FFVuWDA')
  // app.mapSpy(`#map`, 'https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2478.681137224115!2d45.91315441602808!3d51.592407112304684!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x4114c599cd81712b%3A0x2ebcd457d28444b3!2z0YPQuy4g0J_QsNC90YTQuNC70L7QstCwLCA1Mywg0KHQsNGA0LDRgtC-0LIsINCh0LDRgNCw0YLQvtCy0YHQutCw0Y8sIDQxMDAzMw!5e0!3m2!1sru!2sru!4v1618227745566!5m2!1sru!2sru')
})

